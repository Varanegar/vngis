
@using System.Drawing
@using Jmelosegui.Mvc.GoogleMap

@model TrackingMap.Models.AreaModel


    @{
        Html.GoogleMap()
          .Name("map")
          .Zoom(11)
          .FitToMarkersBounds(true)
          .Center(c => c.Latitude(35.6961111).Longitude(51.4230556))

          .ClientEvents(events => events.OnMapClick("addPoint")
               .OnMapLoaded("onMapLoadHandler")

           )
          .Polygons(pf =>
           {
                   pf.Add()
                       .Points(ptn =>
                       {
                           foreach (var pt in Model.AreaPoints)
                           {
                               ptn.Add(pt.Latitude, pt.Longitude);
                           }
                       })
                       .FillColor(Model.Color)
                       .StrokeColor(Color.Gray)

                       .StrokeWeight(1);
           })

          .Polylines(pf =>
          {
              pf.Add()
                  .Points(ptn =>
                  {
                      foreach (var pt in Model.ParentPoints)
                      {
                          ptn.Add(pt.Latitude, pt.Longitude);
                      }
                  })
                  .StrokeColor(Color.Black)
                  .StrokeWeight(3);

              pf.Add()
                   .Points(ptn =>
                    {
                        foreach (var pt in Model.LinePoints)
                        {
                            ptn.Add(pt.Latitude, pt.Longitude);
                        }
                    })
                    .StrokeColor(Model.Color)
                    .StrokeWeight(2);

              
           })
            .Markers(marker =>
            {
                foreach (var pt in Model.AreaPoints)
                {
                    marker.Add()
                        .Draggable(true)
                        .Id("point_" + pt.Id)
                        .Longitude(pt.Longitude)
                        .Latitude(pt.Latitude)
                        .Title("")
                        .Icon("~/Content/img/pin/point.png", new Size(10, 10), new Point(0, 0)
                                , new Point(5, 5));
                }
                foreach (var pt in Model.LinePoints)
                {
                    marker.Add()
                        .Draggable(true)
                        .Id("point_" + pt.Id)
                        .Longitude(pt.Longitude)
                        .Latitude(pt.Latitude)
                        .Title("")
                        .Icon("~/Content/img/pin/point.png", new Size(10, 10), new Point(0, 0)
                                , new Point(5, 5));
                }
                foreach (var pt in Model.CustomerPoints)
                {
                    marker.Add()
                        .Draggable(false)
                        .Id("customer_point_" + pt.Id)
                        .Longitude(pt.Longitude)
                        .Latitude(pt.Latitude)
                        .Title(pt.Desc)
                        .Icon(String.Format("~/Content/img/pin/customer{0}.png",(int)pt.PointType ), new Size(60, 60), new Point(0, 0)
                                , new Point(5, 5));
                }
                
            })
            .MarkerEvents(events => events.OnMarkerDragEnd("onDragEnd"))
            .Render();

    }


    @(Html.GoogleMap().ScriptRegistrar())
